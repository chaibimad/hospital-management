<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Modifier mes informations</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f4f8; margin: 0; padding: 0; }
        .card { max-width: 500px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
        label { display: block; margin-top: 12px; font-weight: bold; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .btn { margin-top: 20px; padding: 12px 24px; background: #27ae60; color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .btn:hover { background: #219a52; }
        .back { display: inline-block; margin-bottom: 15px; color: #3498db; text-decoration: none; }
        .readonly { background:#f3f6f8; color:#2c3e50; }
        .msg { padding: 12px; border-radius: 6px; margin-bottom: 15px; }
        .msg.success { background: #d4edda; color: #155724; }
        .msg.error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div id="app-main">
        <div class="card">
            <h2>Modifier mes coordonnées</h2>
            <div id="message"></div>
            <form id="profilForm">
                <label>N° Sécurité sociale (enregistré par la secrétaire)</label>
                <input type="text" class="readonly" th:value="${patient.numeroSecurite}" readonly>

                <label>Groupe sanguin (enregistré par la secrétaire)</label>
                <input type="text" class="readonly" th:value="${patient.groupeSanguin}" readonly>

                <label>Email (connexion)</label>
                <input type="email" name="email" id="email" th:value="${patient.email}" required>
                <label>Téléphone</label>
                <input type="text" name="telephone" id="telephone" th:value="${patient.telephone}">
                <label>Adresse</label>
                <input type="text" name="adresse" id="adresse" th:value="${patient.adresse}">
                <button type="submit" class="btn">Enregistrer</button>
            </form>
        </div>
    </div>
    <script>
        document.getElementById('profilForm').onsubmit = async (e) => {
            e.preventDefault();
            const body = {
                email: document.getElementById('email').value,
                telephone: document.getElementById('telephone').value,
                adresse: document.getElementById('adresse').value
            };
            try {
                const r = await fetch('/api/patient/profil', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                if (!r.ok) throw new Error('Erreur');
                document.getElementById('message').innerHTML = '<div class="msg success">Modifications enregistrées.</div>';
                setTimeout(() => { document.getElementById('message').innerHTML = ''; }, 3000);
            } catch (err) {
                document.getElementById('message').innerHTML = '<div class="msg error">Erreur lors de l\'enregistrement.</div>';
            }
        };
    </script>
</body>
</html>
