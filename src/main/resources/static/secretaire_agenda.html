<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Agenda - Secrétariat</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f4f8; margin: 0; padding: 0; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #3498db; color: white; }
        .badge { padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: bold; }
        .badge-wait { background: #ffeaa7; color: #d35400; }
        .badge-ok { background: #55efc4; color: #00b894; }
        .badge-annule { background: #dfe6e9; color: #636e72; }
        .badge-termine { background: #74b9ff; color: #fff; }
        .badge-arrive { background: #2ecc71; color: #fff; }
        .btn-cancel { background: #e74c3c; color: white; padding: 5px 10px; border-radius: 5px; border: none; cursor: pointer; font-size: 12px; margin-right: 4px; }
        .btn-done { background: #3498db; color: white; padding: 5px 10px; border-radius: 5px; border: none; cursor: pointer; font-size: 12px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; align-items: end; margin-bottom: 20px; }
        input, select { padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
        .btn { display: inline-block; padding: 10px 16px; background: #27ae60; color: white; text-decoration: none; border-radius: 6px; font-weight: bold; border: none; cursor: pointer; }
        .btn-small { padding: 6px 12px; font-size: 13px; }
        .success { background: #d4edda; color: #155724; padding: 12px; border-radius: 8px; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div id="app-main" class="container">
        <h1>Agenda de la clinique</h1>
        <div th:if="${param.success}" class="success">Rendez-vous enregistré.</div>
        <div th:if="${param.cancelled}" class="success">Rendez-vous annulé.</div>
        <div th:if="${param.done}" class="success">Rendez-vous marqué comme terminé.</div>
        <form th:action="@{/secretaire/rdv/save}" method="post">
            <div class="form-grid">
                <div>
                    <label>Patient</label>
                    <select name="patientId" required>
                        <option value="">-- Choisir --</option>
                        <option th:each="p : ${listePatients}" th:value="${p.id}" th:text="${p.nom + ' ' + p.prenom}"></option>
                    </select>
                </div>
                <div>
                    <label>Médecin</label>
                    <select name="medecinId" required>
                        <option value="">-- Choisir --</option>
                        <option th:each="m : ${listeMedecins}" th:value="${m.id}" th:text="${m.nom + ' ' + m.prenom}"></option>
                    </select>
                </div>
                <div>
                    <label>Date & heure</label>
                    <input type="datetime-local" name="dateHeure" required>
                </div>
                <div>
                    <label>Motif</label>
                    <input type="text" name="motif" placeholder="Ex: Consultation" required>
                </div>
            </div>
            <button type="submit" class="btn">Ajouter RDV</button>
        </form>
        <table>
            <thead>
                <tr>
                    <th>Date & Heure</th>
                    <th>Patient</th>
                    <th>Médecin</th>
                    <th>Motif</th>
                    <th>Statut</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="rdv : ${rdvs}">
                    <td th:text="${#temporals.format(rdv.dateHeure, 'dd/MM/yyyy HH:mm')}"></td>
                    <td th:text="${rdv.patient != null ? rdv.patient.nom + ' ' + rdv.patient.prenom : '-'}"></td>
                    <td th:text="${rdv.medecin != null ? rdv.medecin.nom + ' ' + rdv.medecin.prenom : 'Non assigné'}"></td>
                    <td th:text="${rdv.motif}"></td>
                    <td>
                        <span th:class="${rdv.statut == 'CONFIRMÉ' ? 'badge badge-ok' : (rdv.statut == 'ARRIVE' ? 'badge badge-arrive' : (rdv.statut == 'ANNULE' ? 'badge badge-annule' : (rdv.statut == 'TERMINE' ? 'badge badge-termine' : 'badge badge-wait')))}" th:text="${rdv.statut}"></span>
                    </td>
                    <td>
                        <a th:if="${rdv.statut != 'ANNULE' and rdv.statut != 'TERMINE'}" th:href="@{/secretaire/rdv/modifier/{id}(id=${rdv.id})}" class="btn btn-small">Modifier</a>

                        <form th:if="${rdv.statut != 'ANNULE' and rdv.statut != 'TERMINE' and rdv.statut != 'CONFIRMÉ'}" th:action="@{/secretaire/rdv/confirmer/{id}(id=${rdv.id})}" method="post" style="display:inline;">
                            <button type="submit" class="btn btn-small" style="background:#3498db;">Confirmer</button>
                        </form>

                        <form th:if="${rdv.statut != 'ANNULE' and rdv.statut != 'TERMINE' and rdv.statut != 'ARRIVE'}" th:action="@{/secretaire/rdv/arrive/{id}(id=${rdv.id})}" method="post" style="display:inline;">
                            <button type="submit" class="btn btn-small" style="background:#2ecc71;">Arrivé</button>
                        </form>

                        <form th:if="${rdv.statut != 'ANNULE' and rdv.statut != 'TERMINE'}" th:action="@{/secretaire/rdv/annuler/{id}(id=${rdv.id})}" method="post" style="display:inline;">
                            <input type="text" name="motifAnnulation" placeholder="Raison (optionnel)" style="width:120px; padding:4px;">
                            <button type="submit" class="btn-cancel">Annuler</button>
                        </form>
                        <form th:if="${rdv.statut != 'ANNULE' and rdv.statut != 'TERMINE'}" th:action="@{/secretaire/rdv/terminer/{id}(id=${rdv.id})}" method="post" style="display:inline;">
                            <button type="submit" class="btn-done">Terminer</button>
                        </form>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</body>
</html>
